<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Touch Yellow</title>
    
    <!-- Tab Logo -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='45' fill='%23f2a922' stroke='%23333' stroke-width='10'/></svg>">
    
    <link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&family=Roboto:wght@700&display=swap" rel="stylesheet">
    <style>
        /* RESET & BLACK LINES FRAME */
        * { box-sizing: border-box; }
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            background-color: black; 
            overflow: hidden; 
            font-family: 'Roboto', sans-serif; 
            user-select: none;
            touch-action: none;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* 16:9 CINEMA CONTAINER */
        #game-container {
            width: 100%;
            max-width: 177.78vh; /* Force 16:9 ratio */
            aspect-ratio: 16/9;
            position: relative;
            background-color: #4d4d4d; 
            overflow: hidden;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }

        .screen { position: absolute; width: 100%; height: 100%; top: 0; left: 0; }
        #menu-screen { z-index: 20; }
        #game-screen { background-color: black; z-index: 10; display: none; }

        /* TITLE */
        .title { 
            position: absolute; width: 100%; top: 10%;
            font-family: 'Luckiest Guy', cursive; color: #f2ef45; 
            font-size: 10cqi; 
            line-height: 0.9; 
            text-transform: uppercase; 
            text-shadow: 0.4cqi 0.4cqi 0 #000;
            text-align: center; 
        }

        /* MENU ITEMS */
        .menu-item { position: absolute; display: flex; align-items: center; }
        
        /* Start Button locked to bottom-left area */
        #start-item { left: 5%; bottom: 25%; height: 12%; }
        #exit-item { left: 5%; bottom: 8%; height: 12%; }

        .circle { 
            height: 100%; aspect-ratio: 1/1; 
            background-color: #f2a922; 
            border-radius: 50%; 
            border: 0.5cqi solid #333; 
            cursor: pointer; 
            transition: transform 0.1s;
        }

        .label { 
            font-size: 4cqi; font-weight: 900; color: #000; 
            margin-left: 2cqi; white-space: nowrap; pointer-events: none;
        }
        .label-large { font-size: 6cqi; }

        .circle:hover { transform: scale(1.1); filter: brightness(1.1); }
        .circle:active { transform: scale(0.95); }

        /* GAME OBJECTS */
        .path { position: absolute; background-color: #26a9e1; z-index: 11; pointer-events: auto; }
        .goal { position: absolute; background-color: #f1a92a; z-index: 12; pointer-events: auto; }

        /* DEBUG */
        .debug-border { border: 2px solid red !important; opacity: 0.8; }
    </style>
</head>
<body oncontextmenu="return false;">

    <div id="game-container">
        <!-- MENU -->
        <div id="menu-screen" class="screen">
            <h1 class="title">Touch Yellow</h1>
            
            <div id="start-item" class="menu-item">
                <div id="start-btn" class="circle" 
                     onmousedown="startLevel(1)" 
                     ontouchstart="startLevel(1)"></div>
                <div class="label"><- Start/Restart</div>
            </div>

            <div id="exit-item" class="menu-item">
                <div class="circle" onclick="exitGame()"></div>
                <div class="label label-large"><-Exit</div>
            </div>
        </div>

        <!-- GAME -->
        <div id="game-screen" class="screen"></div>
    </div>

    <script>
        const container = document.getElementById('game-container');
        const menu = document.getElementById('menu-screen');
        const game = document.getElementById('game-screen');
        const startBtn = document.getElementById('start-btn');
        
        let isDraggingFromStart = false;
        let gameActive = false;
        let debugMode = false;

        function toggleFullscreen() {
            if (!document.fullscreenElement && document.documentElement.requestFullscreen) {
                document.documentElement.requestFullscreen().catch(e => console.log(e));
            }
        }
        function exitFullscreenMode() {
            if (document.fullscreenElement) document.exitFullscreen();
        }

        function startLevel(lvl) {
            toggleFullscreen();

            game.innerHTML = ''; 
            isDraggingFromStart = true;
            menu.style.display = 'none';
            game.style.display = 'block';

            if (lvl === 1) {
                // Dimensions relative to the 16:9 container
                const w = container.clientWidth;
                const h = container.clientHeight;
                
                // --- 1. DYNAMIC START POSITION ---
                // We find exactly where the start button is, even if CSS changes.
                const btnRect = startBtn.getBoundingClientRect();
                const contRect = container.getBoundingClientRect();
                
                // Calculate center Y of the button relative to the container
                // (Button Top - Container Top) + (Button Height / 2)
                const relativeBtnTop = btnRect.top - contRect.top;
                const centerY = relativeBtnTop + (btnRect.height / 2);

                const thick = h * 0.14; // 14% Thickness
                const startY = centerY - (thick / 2); // Center path on button

                // --- 2. THE PATHS ---

                // PATH 1: Bottom Horizontal
                // Overlap (+1px) prevents sub-pixel death gaps
                createPath(0, startY, w * 0.55 + 1, thick);

                // PATH 2: Vertical Up
                const p2Height = h * 0.25; 
                const p2X = (w * 0.55) - thick;
                const p2Y = startY - p2Height;
                createPath(p2X, p2Y, thick, p2Height + thick); 

                // PATH 3: Horizontal Right
                const p3Width = w * 0.35;
                createPath(p2X, p2Y, p3Width + 1, thick);

                // PATH 4: Vertical Up (Final)
                const p4Height = h * 0.30; 
                const p4X = p2X + p3Width - thick;
                const p4Y = p2Y - p4Height;
                createPath(p4X, p4Y, thick, p4Height + thick);

                // PATH 5: Top Horizontal Left
                // EXTENDED: Made this longer (45%) to look more balanced
                const p5Width = w * 0.45;
                createPath(p4X - p5Width + thick, p4Y, p5Width, thick);

                // GOAL
                // Positioned on top of the left end of Path 5
                // Overlaps 2px downwards to ensure connectivity
                createGoal(p4X - p5Width, p4Y - thick + 2, thick, thick);
            }

            // Safety Delay
            setTimeout(() => { gameActive = true; }, 200);
        }

        function handleMove(clientX, clientY, multiTouch) {
            if (!gameActive || !isDraggingFromStart) return;
            if (multiTouch) { resetToMenu(); return; }

            const target = document.elementFromPoint(clientX, clientY);

            // Win
            if (target && target.classList.contains('goal')) {
                gameActive = false;
                alert("Level 1 Clear!");
                resetToMenu();
                return;
            }

            // Death Logic
            const isSafe = target && (
                target.classList.contains('path') || 
                target.classList.contains('goal')
            );

            if (!isSafe) {
                if(debugMode) console.log("Died on:", target);
                resetToMenu();
            }
        }

        function createPath(l, t, w, h) {
            const d = document.createElement('div');
            d.className = 'path';
            if(debugMode) d.classList.add('debug-border');
            d.style.left = l + 'px'; d.style.top = t + 'px';
            // Math.ceil ensures we don't get 0.5px gaps
            d.style.width = Math.ceil(w) + 'px'; d.style.height = Math.ceil(h) + 'px';
            game.appendChild(d);
        }

        function createGoal(l, t, w, h) {
            const d = document.createElement('div');
            d.className = 'goal';
            if(debugMode) d.classList.add('debug-border');
            d.style.left = l + 'px'; d.style.top = t + 'px';
            d.style.width = Math.ceil(w) + 'px'; d.style.height = Math.ceil(h) + 'px';
            game.appendChild(d);
        }

        function resetToMenu() {
            gameActive = false;
            isDraggingFromStart = false;
            game.style.display = 'none';
            menu.style.display = 'block'; 
        }

        function exitGame() {
            exitFullscreenMode();
            // Just return to menu UI
            resetToMenu();
        }

        // Listeners
        window.addEventListener('mousemove', e => gameActive && handleMove(e.clientX, e.clientY));
        window.addEventListener('touchmove', e => {
            if(gameActive) { e.preventDefault(); handleMove(e.touches[0].clientX, e.touches[0].clientY, e.touches.length > 1); }
        }, {passive: false});
        
        window.addEventListener('mouseup', () => gameActive && resetToMenu());
        window.addEventListener('touchend', () => gameActive && resetToMenu());
        
        // Commands
        window.cmd = (command) => {
            const c = command.toLowerCase().trim();
            if (c === 'hitbox') {
                debugMode = !debugMode;
                document.querySelectorAll('.path, .goal').forEach(e => e.classList.toggle('debug-border'));
                console.log(`Hitbox Mode: ${debugMode ? "ON" : "OFF"}`);
            } 
            else if (c === 'load menu') {
                resetToMenu();
                console.log("Menu Loaded");
            } 
            else if (c === 'load level1') {
                startLevel(1);
                console.log("Level 1 Loaded");
            } 
        };
    </script>
</body>
</html>