<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Touch Yellow - World 2</title>
    <style>
        body { margin:0; background:#000; overflow:hidden; font-family:'Roboto',sans-serif; height:100vh; display:flex; justify-content:center; align-items:center; user-select:none; touch-action:none; }
        #game { width:100%; max-width:177.7vh; aspect-ratio:16/9; position:relative; background:#000; box-shadow:0 0 50px #00b0f0; }
        .layer { position:absolute; inset:0; pointer-events:none; }
        #ui { z-index:50; pointer-events:auto; text-align:center; display:flex; flex-direction:column; justify-content:center; background:#00b0f0; }
        
        /* MENU - Blue Screen */
        #menu-screen { position:absolute; top:0; left:0; width:100%; height:100%; background-color:#2cb5e9; display:flex; flex-direction:column; align-items:center; justify-content:center; pointer-events:auto; }
        .save-title { font-family:'Roboto',sans-serif; font-weight:900; font-size:10vh; color:#000; margin-bottom:5vh; text-align:center; }
        .menu-btn-row { display:flex; align-items:center; gap:2vh; margin-bottom:3vh; cursor:pointer; transition:transform 0.1s; }
        .menu-btn-row:active { transform:scale(0.95); }
        .btn-circle { width:8vh; height:8vh; background-color:#f2a922; border:0.4vh solid #bf8310; border-radius:50%; box-shadow:0 0.5vh 0 rgba(0,0,0,0.2); }
        .btn-text { font-family:'Roboto',sans-serif; font-weight:900; font-size:5vh; color:#000; }

        /* GAME OBJECTS */
        .obj { position:absolute; transition:background 0.3s; box-shadow: 0 0 0 1px currentColor; }
        .path { background:#26a9e1; color:#26a9e1; } .goal { background:#f1a92a; color:#f1a92a; } .obs { background:#000; color:transparent; } 
        .btn { background:#33cc33; color:#33cc33; } .btn.on { background:#228822; color:#228822; }
        .hitbox { position:absolute; z-index:20; opacity:0; border:1px solid red; }
        .debug .hitbox { opacity:0.5; background:rgba(255,0,0,0.2); }
        .paused { animation-play-state: paused !important; }
        @keyframes openDoor { 100% { transform:translateY(-150%); } }
    </style>
</head>
<body>
    <div id="game">
        <div id="gfx" class="layer" style="z-index:10"></div>
        <div id="phy" class="layer"></div>
        <div id="ui" class="layer">
            <div id="menu-screen">
                <div class="save-title">Got Save!</div>
                <div class="menu-btn-row" onclick="Game.start(6)"><div class="btn-circle"></div><div class="btn-text">&lt;-Continue</div></div>
                <div class="menu-btn-row" onclick="location.href='../index.html'"><div class="btn-circle"></div><div class="btn-text">&lt;-Menu</div></div>
                <div class="menu-btn-row" onclick="alert('Use Browser Close')"><div class="btn-circle"></div><div class="btn-text">&lt;-Exit</div></div>
            </div>
        </div>
    </div>

<script>
const LevelData = {
    6: (d) => {
        const H = 14; const W = 7.875;
        d.path(18, 38, 30, 20); d.path(40, 20, 8, 60); d.path(40, 20, 35, 14); d.path(40, 66, 65, 14);
        const door = d.obs(60, 66, 8, 14, "openDoor 1s forwards"); 
        door.vis.classList.add('paused'); door.hit.classList.add('paused'); door.tag = "gate";
        const btn = d.btn(70, 20, 8, 14); btn.link = "gate"; 
        d.goal(90, 66, 8, 14, 7);
    },
    7: (d) => { d.path(10, 20, 10, 60); d.path(10, 80, 80, 14); d.goal(80, 20, 8, 14, 'win'); }
};

const Game = {
    active: false, mx:0, my:0, mobile:false, holding:false, hitboxes:[],
    els: { gfx:document.getElementById('gfx'), phy:document.getElementById('phy'), ui:document.getElementById('ui') },
    init() {
        this.mobile = 'ontouchstart' in window;
        const move = (x,y) => { this.mx=x; this.my=y; };
        window.addEventListener('mousemove', e => move(e.clientX, e.clientY));
        window.addEventListener('touchmove', e => { e.preventDefault(); move(e.touches[0].clientX, e.touches[0].clientY); }, {passive:false});
        const down = () => this.holding=true;
        const up = () => { this.holding=false; if(this.active && this.mobile) this.die(); };
        window.addEventListener('mousedown', down); window.addEventListener('touchstart', down);
        window.addEventListener('mouseup', up); window.addEventListener('touchend', up);
        this.loop();
    },
    start(id) {
        this.active = true; document.getElementById('menu-screen').style.display='none';
        const builder = {
            path: (x,y,w,h) => this.spawn(x,y,w,h,'path'),
            obs: (x,y,w,h,a) => this.spawn(x,y,w,h,'obs',a),
            goal: (x,y,w,h,n) => this.spawn(x,y,w,h,'goal',n),
            btn: (x,y,w,h) => this.spawn(x,y,w,h,'btn')
        };
        if(LevelData[id]) LevelData[id](builder); else { alert("World 2 Complete!"); location.href='../index.html'; }
    },
    spawn(x,y,w,h,type,anim,next) {
        const s = {left:x+'%', top:y+'%', width:w+'%', height:h+'%'};
        const v = document.createElement('div'); v.className=`obj ${type}`; Object.assign(v.style, s);
        if(anim) v.style.animation = anim;
        this.els.gfx.appendChild(v);
        const p = document.createElement('div'); p.className=`hitbox ${type}`; Object.assign(p.style, s);
        if(anim) p.style.animation = anim;
        this.els.phy.appendChild(p);
        const obj = { vis:v, hit:p, type, next, tag:"", link:"" };
        this.hitboxes.push(obj); return obj;
    },
    loop() {
        requestAnimationFrame(()=>this.loop());
        if(!this.active) return;
        const r = document.getElementById('game').getBoundingClientRect();
        const mx = (this.mx - r.left)/r.width*100;
        const my = (this.my - r.top)/r.height*100;
        if(mx<0||mx>100||my<0||my>100) return this.die();
        if(this.mobile && !this.holding) return;
        let safe = false;
        for(let hb of this.hitboxes) {
            const hr = hb.hit.getBoundingClientRect();
            const bx=(hr.left-r.left)/r.width*100, by=(hr.top-r.top)/r.height*100;
            const bw=hr.width/r.width*100, bh=hr.height/r.height*100;
            if(mx>bx && mx<bx+bw && my>by && my<by+bh) {
                if(hb.type === 'obs') return this.die();
                if(hb.type === 'path') safe = true;
                if(hb.type === 'goal') { safe=true; this.start(hb.next); }
                if(hb.type === 'btn' && hb.link) {
                    safe=true;
                    this.hitboxes.forEach(t => { if(t.tag === hb.link) { t.vis.classList.remove('paused'); t.hit.classList.remove('paused'); }});
                    hb.vis.classList.add('on');
                }
            }
        }
        if(!safe) this.die();
    },
    die() { this.active = false; this.start(6); }
};
Game.init();
window.cmd = (c) => { if(c==='hitbox') document.getElementById('game').classList.toggle('debug'); };
</script>
</body>
</html>