<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Touch Yellow</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='45' fill='%23f2a922' stroke='%23333' stroke-width='10'/></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&family=Roboto:wght@700&display=swap" rel="stylesheet">
    
    <style>
        * { box-sizing: border-box; }
        body { margin: 0; width: 100vw; height: 100vh; background: #000; overflow: hidden; user-select: none; font-family: 'Roboto', sans-serif; display: flex; justify-content: center; align-items: center; }
        
        #game-container { width: 100%; max-width: 177.78vh; aspect-ratio: 16/9; position: relative; background: #000; box-shadow: 0 0 50px rgba(0,0,0,0.5); overflow: hidden; cursor: default; }
        .layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        #phy-layer { z-index: 20; }
        #ui-layer { z-index: 30; }

        /* VISUALS */
        .v-path { position: absolute; background: #26a9e1; box-shadow: 0 0 0 1px #26a9e1; }
        .v-goal { position: absolute; background: #f1a92a; box-shadow: 0 0 0 1px #f1a92a; }
        .v-obs { position: absolute; background: #000; } 
        .v-trig { position: absolute; background: transparent; }
        .hitbox { position: absolute; opacity: 0; } /* Logic boxes */

        /* DEBUG */
        .debug #game-container { background: #330000; cursor: none; }
        .debug .hitbox { display: block !important; opacity: 0.5; border: 2px solid; }
        .debug .type-path { border-color: white; background: rgba(255,255,255,0.1); }
        .debug .type-goal { border-color: lime; background: rgba(0,255,0,0.2); z-index: 100; }
        .debug .type-obs { border-color: red; background: rgba(255,0,0,0.2); z-index: 100; }
        .debug .type-trig { border-color: purple; background: rgba(255,0,255,0.2); z-index: 100; }
        
        /* UI */
        .menu { pointer-events: auto; text-align: center; width: 100%; height: 100%; background: #4d4d4d; position: absolute; top:0; left:0; }
        .title { position: absolute; width: 100%; top: 10%; font-family: 'Luckiest Guy'; color: #f2ef45; font-size: 10cqi; text-shadow: 0.4cqi 0.4cqi 0 #000; }
        
        .btn-wrap { position: absolute; display: flex; align-items: center; pointer-events: auto; cursor: pointer; transition: 0.1s; }
        .btn-wrap:hover { transform: scale(1.1); filter: brightness(1.1); }
        .circle { height: 100%; aspect-ratio: 1/1; background: #f2a922; border-radius: 50%; border: 0.5cqi solid #333; }
        .lbl { font-size: 4cqi; font-weight: 900; color: #000; margin: 0 2cqi; white-space: nowrap; }

        /* Menu Positions */
        #b-start { left: 5%; bottom: 25%; height: 12%; }
        #b-exit { left: 5%; bottom: 8%; height: 12%; }
        #b-save { right: 5%; top: 5%; height: 12%; flex-direction: row-reverse; }

        /* Saves Popup */
        #saves-ui { display: none; background: #4d4d4d; }
        #s1-wrap { left: 20%; bottom: 50%; height: 12%; }
        #s2-wrap { left: 55%; bottom: 50%; height: 12%; }
        #s-back { left: 5%; bottom: 10%; height: 12%; }
        .locked { filter: grayscale(1); cursor: not-allowed; } .unlocked .circle { background: #0f0; }

        /* Toggle */
        #toggle { position: absolute; right: 8%; bottom: 15%; width: 25cqi; display: flex; flex-direction: column; align-items: center; pointer-events: auto; }
        .sw-lbl { font-family: 'Luckiest Guy'; color: #f2ef45; font-size: 3cqi; margin-bottom: 1cqi; text-shadow: 0.1cqi 0.1cqi 0 #000; }
        .switch { position: relative; width: 8cqi; height: 4cqi; }
        .switch input { opacity: 0; width: 100%; height: 100%; position: absolute; z-index: 2; cursor: pointer; }
        .slider { position: absolute; inset:0; background: #333; border-radius: 4cqi; border: 0.3cqi solid #000; transition: .4s; }
        .slider:before { content:""; position: absolute; height: 3.2cqi; width: 3.2cqi; left: 0.4cqi; top: 0.2cqi; background: white; border-radius: 50%; transition: .4s; }
        input:checked + .slider { background: #f2a922; }
        input:checked + .slider:before { transform: translateX(4cqi); }

        /* HUD */
        #meter { position: fixed; display: none; width: 40px; height: 6px; background: #333; border: 1px solid white; z-index: 999; transform: translate(-50%, -20px); pointer-events: none; }
        #fill { width: 0%; height: 100%; background: #0f0; }
        #debug-ui { position: absolute; top: 10px; left: 10px; color: lime; font-family: monospace; background: rgba(0,0,0,0.8); padding: 5px; display: none; pointer-events: none; }
        #noclip-ui { position: absolute; bottom: 10px; left: 10px; color: yellow; font-family: monospace; font-weight: bold; background: rgba(0,0,0,0.8); padding: 5px; border: 1px solid yellow; display: none; pointer-events: none; }
        .db-line { position: fixed; background: cyan; pointer-events: none; z-index: 9999; display: none; }

        /* Animations */
        @keyframes slide { 0% { transform: translateY(0); } 50% { transform: translateY(200%); } 100% { transform: translateY(0); } }
        @keyframes drop { 0% { transform: translateY(-250%); } 100% { transform: translateY(250%); } }
        @keyframes patrol { 0% { transform: translate(0,0); } 25% { transform: translate(1000%,-20%); } 50% { transform: translate(500%,20%); } 75% { transform: translate(1000%,20%); } 90% { transform: translate(500%,-20%); } 100% { transform: translate(0,0); } }
        @keyframes crazy { 0% { transform:translate(0,0); } 20% { transform:translate(200%,400%); } 50% { transform:translate(900%,300%); } 80% { transform:translate(700%,400%); } 100% { transform:translate(0,0); } }
    </style>
</head>
<body>
    <div id="meter"><div id="fill"></div></div>
    <div id="db-x" class="db-line" style="width:100%;height:1px;"></div>
    <div id="db-y" class="db-line" style="width:1px;height:100%;"></div>

    <div id="game-container">
        <div id="gfx-layer" class="layer"></div>
        <div id="phy-layer" class="layer"></div>
        <div id="ui-layer" class="layer">
            <div id="debug-info">DEBUG</div>
            <div id="noclip-ui">NOCLIP</div>
            
            <div id="menu" class="menu">
                <h1 class="title">Touch Yellow</h1>
                <div id="b-start" class="btn-wrap" onclick="Engine.startLevel(1)"><div class="circle"></div><div class="lbl"><- Start</div></div>
                <div id="b-save" class="btn-wrap" onclick="UI.showSaves()"><div class="lbl">Saves -></div><div class="circle"></div></div>
                <div id="b-exit" class="btn-wrap" onclick="Engine.exit()"><div class="circle"></div><div class="lbl"><-Exit</div></div>
                <div id="toggle"><div class="sw-lbl" id="sw-txt">Hover Mode</div><label class="switch"><input type="checkbox" id="sw-in" onchange="Engine.toggleMode()"><span class="slider"></span></label></div>
            </div>

            <div id="saves-ui" class="menu">
                <h1 class="title">Select Save</h1>
                <div id="s1-wrap" class="btn-wrap" onclick="Engine.loadSave(1)"><div id="s1-icon" class="circle"></div><div class="lbl"><- Save 1</div></div>
                <div id="s2-wrap" class="btn-wrap" onclick="Engine.loadSave(2)"><div id="s2-icon" class="circle"></div><div class="lbl"><- Save 2</div></div>
                <div id="s-back" class="btn-wrap" onclick="UI.showMenu()"><div class="circle"></div><div class="lbl"><- Back</div></div>
            </div>
        </div>
    </div>

    <script>
        const Levels = {
            1: (b) => {
                // Layout
                b.path(0, 62, 55.5, 14); b.path(47, 42, 8, 34); b.path(47, 42, 35.5, 14); b.path(74, 22, 8, 34); b.path(37, 22, 45.5, 14);
                // Goal (Top Left)
                b.goal(37, 8, 8, 14, 2);
            },
            2: (b) => {
                b.path(37, 8, 8, 28); // Start
                b.path(47, 42, 8, 34); b.path(47, 42, 35.5, 14); b.path(74, 22, 8, 34); b.path(37, 22, 45.5, 14); b.path(0, 62, 55.5, 14);
                b.goal(20, 63, 6.75, 12, 3);
                b.obs(35, 41, 4.7, 21, "slide 2s linear infinite");
            },
            3: (b) => {
                b.path(0, 62, 30, 14); // Start
                b.path(0, 62, 55.5, 14); b.path(47, 42, 8, 34); b.path(47, 42, 35.5, 14); b.path(74, 22, 8, 34); b.path(37, 22, 45.5, 14);
                b.goal(37, 8, 8, 14, 4);
                b.obs(35, 41, 4.7, 21, "slide 2s linear infinite");
                b.obs(60, 21, 4.7, 21, "slide 3s linear infinite");
                b.obs(67, 22, 4.7, 21, "drop 4s linear infinite");
                b.obs(67, 22, 4.7, 21, "drop 4s linear infinite -1.3s");
                b.obs(67, 22, 4.7, 21, "drop 4s linear infinite -2.6s");
            },
            4: (b) => {
                b.path(15, 10, 75, 14); b.path(82, 10, 8, 60); b.path(5, 60, 85, 35);
                b.trig(25, 60, 2, 30, (g) => { if(!g.moving) { g.moving=true; g.gfx.style.animation=g.hit.style.animation="patrol 3s linear infinite"; } });
                b.goal(10, 65, 8, 14, 5, 500);
            },
            5: (b) => {
                b.path(5, 5, 90, 90);
                b.trig(5, 5, 90, 90, (g) => { if(!g.moving) { g.moving=true; g.gfx.style.animation=g.hit.style.animation="crazy 4s linear infinite"; } });
                b.goal(10, 10, 8, 14, "save", 500);
            }
        };

        const Engine = {
            act: false, drag: false, hold: false, dbg: false, noclip: false, lvl: 0, mx: 0, my: 0, time: 0,
            con: document.getElementById('game-container'),
            l_gfx: document.getElementById('gfx-layer'),
            l_phy: document.getElementById('phy-layer'),
            hitboxes: [],

            init() {
                this.hold = localStorage.getItem('ty_hold') === 'true';
                if(/Mobi/.test(navigator.userAgent)) { this.hold=true; document.getElementById('toggle').style.display='none'; }
                document.getElementById('sw-in').checked = this.hold;
                this.updTxt();

                window.onmousemove = e => { this.mx=e.clientX; this.my=e.clientY; if(this.dbg) this.drawDb(); };
                window.ontouchmove = e => { if(this.act) { e.preventDefault(); this.mx=e.touches[0].clientX; this.my=e.touches[0].clientY; } };
                window.onmousedown = e => { if(e.button===2 && this.act) this.die("Panic"); };
                window.onmouseup = e => { if(e.button!==2 && this.act && this.hold) this.die("Release"); };
                window.onblur = () => { if(this.act && !this.noclip) this.die("Blur"); };

                requestAnimationFrame(this.loop.bind(this));
            },

            startLevel(n) {
                if(!document.fullscreenElement) document.documentElement.requestFullscreen().catch(()=>{});
                this.lvl = n; this.hitboxes = []; this.l_gfx.innerHTML=''; this.l_phy.innerHTML='';
                UI.hide(); this.drag = true; this.time = 0; document.getElementById('meter').style.display='none';
                
                let gr = null; // Goal Ref
                const b = {
                    path: (x,y,w,h) => this.spawn(x,y,w,h,'path'),
                    goal: (x,y,w,h,nxt,ht=0) => { gr=this.spawn(x,y,w,h,'goal',{nxt,ht}); return gr; },
                    obs: (x,y,w,h,an) => { const o=this.spawn(x,y,w,h,'obs'); if(an) o.gfx.style.animation=o.hit.style.animation=an; },
                    trig: (x,y,w,h,cb) => { const t=this.spawn(x,y,w,h,'trig'); t.touch = ()=>cb(gr); }
                };
                
                if(Levels[n]) Levels[n](b);
                if(this.dbg) this.toggleDebug(true);
                setTimeout(()=>this.act=true, 50);
            },

            spawn(x,y,w,h,type,data={}) {
                const gfx = document.createElement('div'); gfx.className = `visual-${type}`;
                gfx.style.cssText = `left:${x}%;top:${y}%;width:${w}%;height:${h}%`;
                this.l_gfx.appendChild(gfx);

                const hit = document.createElement('div'); hit.className = `hitbox type-${type}`;
                hit.style.cssText = `left:${x}%;top:${y}%;width:${w}%;height:${h}%`;
                this.l_phy.appendChild(hit);

                const obj = { x,y,w,h,type,gfx,hit, ...data };
                this.hitboxes.push(obj);
                return obj;
            },

            loop() {
                if(this.act) {
                    if(this.hold && !this.drag) return;
                    const r = this.con.getBoundingClientRect();
                    const mx = (this.mx - r.left)/r.width*100;
                    const my = (this.my - r.top)/r.height*100;
                    
                    let safe = false, goal = null;
                    if(mx<0||mx>100||my<0||my>100) return this.die("Out");

                    for(let o of this.hitboxes) {
                        const b = o.hit.getBoundingClientRect();
                        const bx=(b.left-r.left)/r.width*100, by=(b.top-r.top)/r.height*100, bw=b.width/r.width*100, bh=b.height/r.height*100;
                        
                        if(mx>=bx && mx<=bx+bw && my>=by && my<=by+bh) {
                            if(o.type==='path') safe=true;
                            if(o.type==='goal') { safe=true; goal=o; }
                            if(o.type==='trig') { safe=true; if(o.touch) o.touch(); }
                            if(o.type==='obs') return this.die("Obs");
                        }
                    }

                    if(!safe && !this.noclip) this.die("Void");
                    
                    if(goal) {
                        if(goal.ht === 0) this.win(goal.nxt);
                        else {
                            this.time += 16;
                            const p = Math.min(100, (this.time/goal.ht)*100);
                            document.getElementById('meter').style.display='block';
                            document.getElementById('meter').style.left=this.mx+'px';
                            document.getElementById('meter').style.top=(this.my-20)+'px';
                            document.getElementById('fill').style.width=p+'%';
                            if(this.time >= goal.ht) this.win(goal.nxt);
                        }
                    } else { this.time=0; document.getElementById('meter').style.display='none'; }
                }
                requestAnimationFrame(this.loop.bind(this));
            },

            win(nxt) {
                this.act=false;
                if(nxt==='save') { localStorage.setItem('touchYellow_save1', 'true'); window.location.href='save/save1.html'; }
                else this.startLevel(nxt);
            },

            die(msg) {
                if(this.noclip) return;
                console.log("Died: "+msg);
                this.act=false; 
                if(this.lvl >= 5) this.startLevel(5); else UI.showMenu();
            },

            exit() { if(document.fullscreenElement) document.exitFullscreen(); UI.showMenu(); },
            
            toggleMode() { 
                this.hold = document.getElementById('sw-in').checked; 
                localStorage.setItem('ty_hold', this.hold); this.updTxt(); 
            },
            updTxt() { 
                const t = document.getElementById('sw-txt'); 
                t.innerText = this.hold ? "Hold Mode" : "Hover Mode"; 
                t.style.color = this.hold ? "#f2a922" : "#f2ef45"; 
            },

            toggleDebug(v) {
                this.dbg = v!==undefined?v:!this.dbg;
                document.body.classList.toggle('debug', this.dbg);
                document.getElementById('debug-info').style.display=this.dbg?'block':'none';
                document.querySelectorAll('.db-line').forEach(e=>e.style.display=this.dbg?'block':'none');
            },
            drawDb() {
                document.getElementById('db-x').style.top=this.my+'px';
                document.getElementById('db-y').style.left=this.mx+'px';
            },
            
            loadSave(n) { if(localStorage.getItem(`touchYellow_save${n}`)) window.location.href=`save/save${n}.html`; else alert("Locked"); }
        };

        const UI = {
            showMenu() { document.getElementById('menu').style.display='block'; document.getElementById('saves-ui').style.display='none'; },
            showSaves() { 
                document.getElementById('menu').style.display='none'; document.getElementById('saves-ui').style.display='block'; 
                ['1','2'].forEach(i => {
                    const el = document.getElementById(`s${i}-icon`);
                    el.style.background = localStorage.getItem(`touchYellow_save${i}`) ? '#0f0' : '#f2a922';
                });
            },
            hide() { document.getElementById('menu').style.display='none'; document.getElementById('saves-ui').style.display='none'; }
        };

        Engine.init();
        window.cmd = c => {
            if(c==='hitbox') Engine.toggleDebug();
            if(c==='noclip') { Engine.noclip=!Engine.noclip; document.getElementById('noclip-ui').style.display=Engine.noclip?'block':'none'; }
            if(c==='clear') localStorage.clear();
        };
    </script>
</body>
</html>