<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Touch Yellow Web</title>
    <link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&family=Roboto:wght@900&display=swap" rel="stylesheet">
    <style>
        body { margin:0; background:#000; overflow:hidden; font-family:'Roboto',sans-serif; height:100vh; display:flex; justify-content:center; align-items:center; user-select:none; touch-action:none; }
        #game { width:100%; max-width:177.7vh; aspect-ratio:16/9; position:relative; background:#000; box-shadow:0 0 50px #333; }
        .layer { position:absolute; inset:0; pointer-events:none; }
        #ui { z-index:500; pointer-events:auto; }

        /* MENU STYLES */
        .menu-bg { background-color:#4d4d4d; width:100%; height:100%; position:absolute; top:0; left:0; pointer-events:auto; cursor:default; }
        .grid-line { position:absolute; border:1px dashed rgba(255,255,255,0.3); pointer-events:none; }
        .grid-x { width:100%; height:0; top:50%; left:0; }
        .grid-y { width:0; height:100%; top:0; left:50%; }

        #title-wrapper { position:absolute; top:5%; width:100%; display:flex; justify-content:center; align-items:flex-start; pointer-events:none; z-index:100; line-height:0.85; }
        #t-left { flex:1; text-align:right; padding-right:0.5vh; }
        #t-right { flex:1; text-align:left; padding-left:0.5vh; position:relative; }
        .title-text { font-family:'Luckiest Guy',cursive; font-size:14vh; color:#ffff00; text-transform:uppercase; text-shadow:0.8vh 0.8vh 0 #000; letter-spacing:-0.5vh; display:inline-block; }
        .title-sub { font-family:'Luckiest Guy',cursive; font-size:5vh; color:#ff9900; text-transform:uppercase; text-shadow:0.4vh 0.4vh 0 #000; position:absolute; top:10.5vh; left:14vh; transform:rotate(-3deg); }

        .btn-group { position:absolute; display:flex; align-items:center; gap:15px; cursor:pointer; transition:transform 0.1s; }
        .btn-group:active { transform:scale(0.95); }
        .btn-label { font-family:'Roboto',sans-serif; font-weight:bold; font-size:3.5vh; color:#000; text-shadow: 0 0 2px rgba(255,255,255,0.5); }
        .circle-btn { width:8vh; height:8vh; background:#f2a922; border:0.4vh solid #b37a15; border-radius:50%; box-shadow:0 0 10px rgba(0,0,0,0.5); }
        
        #grp-saves   { top:22%; right:5%; }
        #grp-creator { top:38%; right:5%; }
        #grp-start   { bottom:28%; left:15%; }
        #grp-exit    { bottom:8%; left:15%; }

        /* SAVE SELECT */
        #saves-screen { display:none; position:absolute; top:0; left:0; width:100%; height:100%; background-color:#4d4d4d; z-index:600; cursor:default; }
        .save-title { position:absolute; top:15%; width:100%; text-align:center; font-family:'Luckiest Guy',cursive; font-size:12vh; color:#ffff00; text-shadow:0.6vh 0.6vh 0 #000; }
        .save-row { position:absolute; top:45%; width:100%; display:flex; justify-content:center; gap:15vh; }
        .slot-group { display:flex; align-items:center; gap:10px; cursor:pointer; transition:transform 0.1s; }
        .slot-group:active { transform:scale(0.95); }
        .slot-btn { width:10vh; height:10vh; border-radius:50%; border:0.5vh solid #000; box-shadow:0 0 10px rgba(0,0,0,0.5); }
        .slot-locked { background-color:#444; border-color:#222; cursor:not-allowed; opacity:0.7; }
        .slot-unlocked { background-color:#00ff00; border-color:#004400; cursor:pointer; }
        #btn-back { position:absolute; bottom:10%; left:10%; display:flex; align-items:center; gap:15px; cursor:pointer; }
        .back-circle { width:10vh; height:10vh; background:#fca503; border:0.5vh solid #000; border-radius:50%; }

        /* GAME ELEMENTS */
        .obj { position:absolute; box-shadow: 0 0 0 1px currentColor; }
        .path { background:#26a9e1; color:#26a9e1; } .goal { background:#f1a92a; color:#f1a92a; } 
        .obs { background:#000; color:transparent; } 
        .btn { background:#33cc33; color:#33cc33; } .btn.on { background:#228822; color:#228822; }
        .paused { animation-play-state: paused !important; }
        
        /* DEBUG VISUALS */
        .hitbox { position:absolute; z-index:400; opacity:0; pointer-events:none; }
        .debug .hitbox { opacity:1 !important; }
        .debug .hitbox.path { background:transparent; border:none; }
        .debug .hitbox.goal { background:rgba(0,255,0,0.5); border:2px solid lime; }
        .debug .hitbox.obs { background:rgba(255,0,0,0.5); border:2px solid red; background-image: repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(0,0,0,0.5) 10px, rgba(0,0,0,0.5) 20px); }
        .debug .hitbox.trig, .debug .hitbox.btn { background:rgba(148,0,211,0.5); border:2px dashed magenta; }
        .debug .hitbox.start { background:rgba(0,255,0,0.1); border:1px dotted lime; }

        /* DEBUG OVERLAY */
        .debug-overlay { display:none; pointer-events:none; position:absolute; top:0; left:0; width:100%; height:100%; z-index:9999; }
        .debug .debug-overlay { display:block; }
        #db-cross-x { position:absolute; width:100%; height:1px; background-color:cyan; left:0; }
        #db-cross-y { position:absolute; width:1px; height:100%; background-color:cyan; top:0; }
        #db-coords { position:absolute; bottom:5px; right:5px; color:cyan; font-family:monospace; font-size:2vh; font-weight:bold; background:rgba(0,0,0,0.8); padding:2px 5px; border:1px solid cyan; }
        #db-room { position:absolute; bottom:5px; left:5px; color:cyan; font-family:monospace; font-size:2vh; font-weight:bold; background:rgba(0,0,0,0.8); padding:2px 5px; border:1px solid cyan; }
        
        #cheat-ind { position:absolute; bottom:10px; left:10px; color:yellow; font-weight:bold; display:none; z-index:999; font-family:monospace; font-size:2vh; }
        #debug-ind { position:absolute; bottom:35px; left:10px; color:lime; font-weight:bold; display:none; z-index:999; font-family:monospace; font-size:2vh; }
        #catch-meter { position:fixed; display:none; width:40px; height:6px; background:#333; border:1px solid white; border-radius:3px; pointer-events:none; z-index:9999; transform:translate(-50%,-20px); }
        #catch-fill { width:0%; height:100%; background:#00ff00; transition:width 0.05s linear; }
        #dynamic-css { display:none; }

        @keyframes slicerMove { 0% { transform: translateY(0%); } 50% { transform: translateY(200%); } 100% { transform: translateY(0%); } }
        @keyframes waterfallDrop { 0% { transform: translateY(-250%); } 100% { transform: translateY(250%); } }
        @keyframes crazyMove { 0% { transform: translate(0, 0); } 20% { transform: translate(250%, -350%); } 40% { transform: translate(250%, 0%); } 60% { transform: translate(120%, -150%); } 80% { transform: translate(0, -350%); } 100% { transform: translate(0, 0); } }
        @keyframes safeRoomPatrol { 0% {transform:translate(0,0)} 25%{transform:translate(1000%,-20%)} 50%{transform:translate(500%,20%)} 75%{transform:translate(1000%,20%)} 90%{transform:translate(500%,-20%)} 100%{transform:translate(0,0)} }
        @keyframes superCrazyMove { 0% { transform: translate(0,0); } 10% { transform: translate(800%, 200%); } 20% { transform: translate(200%, 400%); } 30% { transform: translate(600%, 0%); } 40% { transform: translate(0%, 300%); } 50% { transform: translate(900%, 300%); } 60% { transform: translate(400%, 100%); } 70% { transform: translate(100%, 0%); } 80% { transform: translate(700%, 400%); } 90% { transform: translate(300%, 100%); } 100% { transform: translate(0,0); } }
    </style>
</head>
<body oncontextmenu="return false;">
    <div id="catch-meter"><div id="catch-fill"></div></div>
    
    <div id="game">
        <div class="debug-overlay">
            <div id="db-cross-x"></div><div id="db-cross-y"></div>
            <div id="db-coords">X: 0.00% Y: 0.00%</div><div id="db-room">ROOM: MENU</div>
        </div>

        <div id="gfx" class="layer" style="z-index:10"></div>
        <div id="phy" class="layer"></div>
        <div id="ui" class="layer">
            
            <!-- MAIN MENU -->
            <div id="menu" class="menu-bg">
                <div class="grid-line grid-x"></div><div class="grid-line grid-y"></div>
                <div id="title-wrapper">
                    <div id="t-left"><span class="title-text">Touch</span></div>
                    <div id="t-right"><span class="title-text">Yellow</span><div class="title-sub">Web</div></div>
                </div>
                <div id="grp-saves" class="btn-group" onclick="Engine.openSavesMenu()"><span class="btn-label">Saves -&gt;</span><div class="circle-btn"></div></div>
                <div id="grp-creator" class="btn-group" onclick="location.href='creator.html'"><span class="btn-label">Creator -&gt;</span><div class="circle-btn"></div></div>
                <div id="grp-start" class="btn-group" onclick="Engine.start(1)"><div class="circle-btn"></div><span class="btn-label">&lt;- Start/Restart</span></div>
                <div id="grp-exit" class="btn-group" onclick="if(document.fullscreenElement) document.exitFullscreen(); Engine.toMenu();"><div class="circle-btn"></div><span class="btn-label">&lt;- Exit</span></div>
            </div>

            <!-- SAVE SELECT OVERLAY -->
            <div id="saves-screen">
                <div class="save-title">SELECT SAVE</div>
                <div class="save-row">
                    <div id="slot-1" class="slot-group" onclick="Engine.loadSave(1)"><div id="circle-1" class="slot-btn slot-locked"></div><span class="btn-label">&lt;- Save 1</span></div>
                    <div id="slot-2" class="slot-group" onclick="Engine.loadSave(2)"><div id="circle-2" class="slot-btn slot-locked"></div><span class="btn-label">&lt;- Save 2</span></div>
                </div>
                <div id="btn-back" onclick="Engine.closeSaves()"><div class="back-circle"></div><span class="btn-label">&lt;- Back</span></div>
            </div>

            <div id="cheat-ind">NOCLIP ON</div>
            <div id="debug-ind">HITBOXES ON</div>
        </div>
    </div>

<script>
const DrawStandard = (d) => {
    const H = 14; const W = 7.875; const sY = 62;
    const p2X = 55 - W; const p2Y = sY - 20;
    const p4X = p2X + 35 - W; const p4Y = p2Y - 24; const topX = p4X - 45 + W;
    d.path(0, sY, 55, H); d.path(p2X, p2Y, W, 20 + H); d.path(p2X, p2Y, 35, H);
    d.path(p4X, p4Y, W, 24 + H); d.path(topX, p4Y, 45, H);
    return { topX, p4Y, W, H, sY, midY: p2Y };
};

const LevelData = {
    1: (d) => { const g = DrawStandard(d); d.goal(g.topX, g.p4Y - g.H, g.W, g.H, 2); },
    2: (d) => { 
        const g = DrawStandard(d); d.path(g.topX, g.p4Y - g.H, g.W, g.H * 2); d.goal(20, 63, 6.75, 12, 3);
        d.obs(35, g.sY - (g.H * 1.5), g.W * 0.6, g.H * 1.5, "slicerMove 2s linear infinite");
    },
    3: (d) => {
        const g = DrawStandard(d); d.path(0, g.sY, 30, g.H); 
        // Goal moved to right (55%) to align with Lvl 4 safe zone
        d.goal(55, g.p4Y - g.H, g.W, g.H, 4);
        const oW = g.W * 0.6; const oH = g.H * 1.5;
        d.obs(32, g.sY - oH, oW, oH, "slicerMove 2s linear infinite"); d.obs(42, g.midY - oH, oW, oH, "slicerMove 3s linear infinite");
        d.obs(75, g.p4Y, oW, g.H*1.5, "waterfallDrop 4s linear infinite"); d.obs(75, g.p4Y, oW, g.H*1.5, "waterfallDrop 4s linear infinite -1.3s");
    },
    4: (d) => { 
        // Z-SHAPE TRAP
        const H = 14; const W = 7.875;
        d.path(50, 0, 50, 50); d.path(0, 50, 100, 50); // Z-Shape Safe Zones
        
        const g = d.goal(10, 65, W, H, 5, 500); // 500ms Hold
        g.vis.style.animation = "crazyMove 3s linear infinite"; g.hit.style.animation = "crazyMove 3s linear infinite";
        g.vis.classList.add('paused'); g.hit.classList.add('paused'); g.tag="runner";
        
        const t = d.trig(35, 50, 2, 50); t.link = "runner";
    },
    5: (d) => { 
        d.path(5, 5, 90, 90); 
        const g = d.goal(10, 10, 10, 10, "redirect_save1", 500); // 500ms Hold
        g.vis.style.animation = "superCrazyMove 4s linear infinite"; g.hit.style.animation = "superCrazyMove 4s linear infinite";
        g.vis.classList.add('paused'); g.hit.classList.add('paused'); g.tag="run";
        const t = d.trig(5,5,90,90); t.link="run";
    }
};

const Engine = {
    active: false, state: 'menu', mx:0, my:0, mobile:false, holding:false, hitboxes:[], noclip: false, goalTimer:0, linkPlay: false,
    els: { gfx:document.getElementById('gfx'), phy:document.getElementById('phy'), menu:document.getElementById('menu'), hud:document.getElementById('catch-meter'), fill:document.getElementById('catch-fill'), css:document.getElementById('dynamic-css') },

    init() {
        const urlParams = new URLSearchParams(window.location.search);
        if(urlParams.has('data')) {
            try {
                localStorage.setItem('ty_custom_level_data', JSON.stringify(JSON.parse(atob(urlParams.get('data')))));
                this.linkPlay = true; this.els.menu.style.display = 'none';
                setTimeout(() => this.start('custom'), 50);
            } catch(e) { alert("Corrupt Link"); }
        }

        this.mobile = 'ontouchstart' in window;
        const move = (x,y) => { 
            this.mx=x; this.my=y; 
            const cx = document.getElementById('db-cross-x');
            const cy = document.getElementById('db-cross-y');
            const ct = document.getElementById('db-coords');
            if(cx && cy) { 
                const r = document.getElementById('game').getBoundingClientRect();
                const ly = y - r.top; const lx = x - r.left;
                cx.style.top = ly + 'px'; cy.style.left = lx + 'px';
                if(ct) ct.innerText = `X: ${(lx/r.width*100).toFixed(2)}% Y: ${(ly/r.height*100).toFixed(2)}%`;
            }
        };
        window.addEventListener('mousemove', e => move(e.clientX, e.clientY));
        window.addEventListener('touchmove', e => { e.preventDefault(); move(e.touches[0].clientX, e.touches[0].clientY); }, {passive:false});
        
        const down = () => this.holding=true;
        const up = () => { this.holding=false; if(this.state==='playing' && this.mobile) this.die(); };
        window.addEventListener('mousedown', down); window.addEventListener('touchstart', down);
        window.addEventListener('mouseup', up); window.addEventListener('touchend', up);
        
        // Right Click Death
        window.addEventListener('mousedown', e => { if(e.button===2 && this.active && !this.noclip) this.die(); });

        // Restore Settings
        if(localStorage.getItem('touchYellow_noclip')==='true'){ this.noclip=true; document.getElementById('cheat-ind').style.display='block'; }
        if(localStorage.getItem('touchYellow_debug')==='true'){ document.getElementById('game').classList.add('debug'); document.getElementById('debug-ind').style.display='block'; }
        
        this.loop();
    },

    start(id) {
        if(id === "redirect_save1") { localStorage.setItem('touchYellow_save1','true'); location.href='save/save1.html'; return; }
        
        if (!document.fullscreenElement) { document.documentElement.requestFullscreen().catch(e=>{}); }

        this.reset();
        this.active = true;
        this.els.menu.style.display='none'; document.getElementById('saves-screen').style.display='none';
        
        // Custom = Ghost Mode, Official = Instant
        this.state = (id==='custom') ? 'waiting' : 'playing'; 
        
        document.getElementById('db-room').innerText = (id==='custom') ? "ROOM: CUSTOM" : "ROOM: LEVEL " + id;
        
        const builder = {
            path: (x,y,w,h) => this.spawn(x,y,w,h,'path'),
            obs: (x,y,w,h,a) => this.spawn(x,y,w,h,'obs',a),
            goal: (x,y,w,h,n,t) => this.spawn(x,y,w,h,'goal',null,n,t),
            trig: (x,y,w,h) => this.spawn(x,y,w,h,'trig')
        };

        if(id === 'custom') this.loadCustom(builder);
        else if(LevelData[id]) LevelData[id](builder);
        else { alert("You Win!"); this.toMenu(); }
    },

    loadCustom(builder) {
        const raw = localStorage.getItem('ty_custom_level_data');
        if (!raw) { alert("No custom level found."); this.toMenu(); return; }
        try { this.parseCookie(raw, builder); } catch(e) { alert("Level Corrupt"); this.toMenu(); }
    },

    parseCookie(jsonStr, d) {
        const data = JSON.parse(jsonStr);
        let css = "";
        data.forEach(o => {
            const types = ['path','obs','goal','start','btn','trig'];
            const t = types[o[0]];
            let anim = null;
            if(o[5] && o[5].length) {
                const nm = `a-${Math.random().toString(36).substr(2)}`;
                css += `@keyframes ${nm} { 0%{transform:translate(0,0)} `;
                o[5].forEach((k,i) => css += `${Math.round((i+1)/(o[5].length+1)*100)}%{transform:translate(${k[0]}%,${k[1]}%)} `);
                css += `100%{transform:translate(0,0)} } `;
                anim = `${nm} ${o[9]||2}s linear infinite`;
            }
            const obj = this.spawn(o[1],o[2],o[3],o[4], t, anim, (t==='goal'?'menu':null));
            if(o[6]) obj.tag = o[6]; if(o[7]) obj.link = o[7];
            if(o[8]) { obj.vis.classList.add('paused'); obj.hit.classList.add('paused'); }
            if(o[10]) obj.vis.style.zIndex = o[10];
        });
        this.els.css.innerHTML += css;
    },

    spawn(x,y,w,h,type,anim,next,holdTime) {
        const s = {left:x+'%', top:y+'%', width:w+'%', height:h+'%'};
        const v = document.createElement('div'); v.className=`obj ${type}`; Object.assign(v.style, s);
        if(anim) v.style.animation = anim;
        this.els.gfx.appendChild(v);
        const p = document.createElement('div'); p.className=`hitbox ${type}`; Object.assign(p.style, s);
        if(anim) p.style.animation = anim;
        this.els.phy.appendChild(p);
        const obj = { vis:v, hit:p, type, next, tag:"", link:"", hold:holdTime||0 };
        this.hitboxes.push(obj);
        return obj;
    },

    loop() {
        requestAnimationFrame(()=>this.loop());
        if(!this.active) return;
        const r = document.getElementById('game').getBoundingClientRect();
        const mx = (this.mx - r.left)/r.width*100;
        const my = (this.my - r.top)/r.height*100;
        
        if((mx<0||mx>100||my<0||my>100) && this.state==='playing') return this.die();
        if(this.mobile && !this.holding) return;
        let safe = false;
        let touchingGoal = false;
        
        for(let hb of this.hitboxes) {
            const hr = hb.hit.getBoundingClientRect();
            const bx=(hr.left-r.left)/r.width*100, by=(hr.top-r.top)/r.height*100;
            const bw=hr.width/r.width*100, bh=hr.height/r.height*100;

            if(mx>bx && mx<bx+bw && my>by && my<by+bh) {
                if(hb.type === 'obs' && this.state==='playing') return this.die();
                if(hb.type === 'path') safe = true;
                if(hb.type === 'start') { safe = true; if(this.state === 'waiting') { this.state = 'playing'; } }
                
                if(hb.type === 'goal') { 
                    safe=true; touchingGoal=true; 
                    if(hb.hold > 0) {
                        this.goalTimer += 16;
                        this.els.hud.style.display='block';
                        this.els.hud.style.left = this.mx+'px'; this.els.hud.style.top = (this.my-20)+'px';
                        this.els.fill.style.width = (this.goalTimer/hb.hold*100)+'%';
                        if(this.goalTimer >= hb.hold) this.win(hb.next);
                    } else { this.win(hb.next); }
                }
                if((hb.type==='btn' || hb.type==='trig') && hb.link) {
                    safe=true;
                    this.hitboxes.forEach(t => { if(t.tag === hb.link) { t.vis.classList.remove('paused'); t.hit.classList.remove('paused'); }});
                    if(hb.type==='btn') hb.vis.classList.add('on');
                }
            }
        }
        document.getElementById('game').style.cursor = (this.state==='playing' && safe) ? 'crosshair' : 'default';
        if(!touchingGoal) { this.goalTimer=0; this.els.hud.style.display='none'; }
        if(this.state === 'playing' && !safe) this.die();
    },

    win(next) { if(next==='menu') { alert("Complete!"); if(this.linkPlay) this.start('custom'); else this.toMenu(); } else this.start(next); },
    die() { if(this.noclip) return; this.active = false; if(this.linkPlay) this.start('custom'); else this.toMenu(); },
    reset() { this.active=false; this.hitboxes=[]; this.els.gfx.innerHTML=''; this.els.phy.innerHTML=''; document.getElementById('game').style.cursor='default'; },
    toMenu() { this.reset(); this.els.menu.style.display='block'; document.getElementById('db-room').innerText="ROOM: MENU"; },
    
    // UI LOGIC
    openSavesMenu() { document.getElementById('saves-screen').style.display='block'; document.getElementById('menu').style.display='none'; this.checkSave(1); this.checkSave(2); },
    closeSaves() { document.getElementById('saves-screen').style.display='none'; document.getElementById('menu').style.display='block'; },
    checkSave(n) { const has = localStorage.getItem(`touchYellow_save${n}`) === 'true'; document.getElementById(`circle-${n}`).className = `slot-btn slot-${has?'unlocked':'locked'}`; },
    loadSave(n) { if(localStorage.getItem(`touchYellow_save${n}`) === 'true') location.href=`save/save${n}.html`; else alert("Locked!"); }
};

Engine.init();

// --- COMMANDS ---
Object.defineProperties(window, {
    'debug': { get: function() { const g=document.getElementById('game'); g.classList.toggle('debug'); const on=g.classList.contains('debug'); document.getElementById('debug-ind').style.display=on?'block':'none'; localStorage.setItem('touchYellow_debug', on); return `Debug: ${on?"ON":"OFF"}`; } },
    'noclip': { get: function() { Engine.noclip=!Engine.noclip; document.getElementById('cheat-ind').style.display=Engine.noclip?'block':'none'; localStorage.setItem('touchYellow_noclip', Engine.noclip); return `God Mode: ${Engine.noclip?"ON":"OFF"}`; } },
    'clear': { get: function() { localStorage.clear(); alert("Wiped"); window.location.href='index.html'; return "Resetting..."; } }
});
window.s1='save1'; window.s2='save2'; window.menu='menu';
window.load = function(t) {
    if(typeof t==='number') { Engine.start(t); return `Level ${t}`; }
    const s=String(t).toLowerCase();
    if(s==='menu') { Engine.toMenu(); return "Menu"; }
    if(s==='save'||s==='saves') { Engine.openSavesMenu(); return "Saves"; }
    if(s==='save1'||s==='s1') { localStorage.setItem('touchYellow_save1','true'); location.href='save/save1.html'; return "World 2"; }
    if(s==='save2'||s==='s2') { localStorage.setItem('touchYellow_save2','true'); alert("Unlocked 2"); Engine.openSavesMenu(); return "Unlock"; }
};
</script>
</body>
</html>